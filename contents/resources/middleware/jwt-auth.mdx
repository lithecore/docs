---
title: JWT  
description: The JWT (JSON Web Token) middleware in Lithe allows for secure user authentication and the protection of specific routes in your application.  
---

## Installing the JWT Middleware

To use the JWT middleware in your Lithe project, you need to install the `lithephp/jwt-auth` package. This can be easily done via Composer. Run the following command in the terminal:

```bash
composer require lithephp/jwt-auth
```

After installation, you will be ready to configure and use the JWT middleware in your application.

## Using the JWT Middleware

The JWT middleware in Lithe is designed to allow user authentication through JWT tokens. To configure it, define it in your application using an instance of the middleware and provide the secret and configuration options:

```php
use Lithe\Middleware\Auth\JWT;

define('loggedIn', JWT('your-secret', [
    'alg' => 'HS256',                    // Default algorithm
    'authHeader' => 'Authorization',     // Header where the JWT token will be sent
    'tokenPrefix' => 'Bearer',           // Token prefix in the header
    'leeway' => 60,                      // Time tolerance
    'renew' => false,                    // Allow token renewal
    'renewThreshold' => 300,             // Renew the token if there are 5 minutes left to expire
]));
```

### Protecting Routes with JWT Middleware

To protect a specific route using the JWT middleware, add `loggedIn` as a parameter in the route definition:

```php
$app->get('/account/', loggedIn, function ($req, $res) {
    $res->send('Protected content accessed successfully!');
});
```

### Generating and Verifying JWT Tokens

The JWT middleware provides methods to generate and verify tokens:

- **generateToken($user, $idKey = 'id', array $additionalClaims = []): string**  
  Generates a JWT token for a specific user. You can specify the user ID key and add additional claims to the payload.

  ```php
  $token = $req->jwt->generateToken($user);
  ```

### Renewing JWT Tokens

If the `renew` option is enabled and the token is close to expiration, the middleware will automatically handle the renewal by checking if the token is about to expire. The new token will be included in the response header if renewal is necessary.

### Error Handling

Be prepared to handle exceptions thrown when the JWT token is invalid or missing. The middleware will throw an `HttpException` with code 401 if the token is not provided or is invalid.

## Considerations

- **Security**: The use of JWT tokens increases security by allowing authentication without the need to store sensitive information on the server. Make sure to keep your secret secure.
- **Token Expiration**: Set an appropriate expiration time for your tokens. Expired tokens will not be accepted, so have a renewal plan in mind for a good user experience.
- **Error Handling**: Be prepared to handle exceptions thrown when the JWT token is invalid or missing. This may include redirecting to an error page or displaying an appropriate message to the user. Refer to the [HTTP Exceptions documentation](/docs/digging-deep/http-exceptions) for more details.
